# Инфраструктурная модель Системы
Описание инфрастуктуры
Схема
![144](https://i.imgur.com/KTpJX2A.jpg)

Предлагается размещать приложения складов и доставки локально в каждом регионе присутствия самих бизнес-юнитов (складов и логистических служб), т.е мы должны понимать, что в некоторых регионах складов не будет и доставщиков не будет.

Приложения в которых будет присутствовать клиент должны иметь распределенную сеть ЦОДов.

## Приоритеты восстановления
При потере соединений приоритетность восстановления выстраивается  в следующем порядке:
1. Социальная сеть
2. Телеметрия
3. Интернет-магазин
4. Сервисы складов и логистики

## Разворачивание
Накат на фронт-приложения и интернет-магазин производится 
канареечным деплоем. Необходимо применять испытательные стенды для переноса изменений на продуктив

## Стратегия резервирования данных

Бекапы должны создаваться для:
- Социальной сети и телеметрии – полное копирование ИБД  раз в сутки в конце операционного дня, например с 00.00 до 00.30 с глубиной хранения в – 7 дней.
- Интернет-магазина - – полное копирование ИБД  раз в 2 суток в конце операционного дня, например с 00.00 до 00.30 с глубиной хранения в – 14 дней.
- остальных сервисов – разностное копирование ИБД раз в сутки и полное копирование 2 раза в неделю, например, вторник и пятница, но тогда без разностного, глубина хранения та же.
Восстановление ИБД будет производиться с предварительным тестированием аналогично накату обновлений.

## Прочие моменты
1. Общее повышение степени надежности. 
Рекомендуем создавать резервные копии ИБД с распределением по разным ЦОДам – организовать распределенные хранения по расписанию (1-е =1 ЦОД, 2-е =2 ЦОД....11-е =1 ЦОД...).

2. При диагностике разрыва текущей связи решение о переключении на другой ЦОД будет принимать Оркестратор по критерию падения траффика. Также необходимо настроить мониторинг работы сервисов с помощью логирования.

3. Также для сохранения краткосрочных данных в пользовательском сеансе приложения последнюю часть сессии глубиной в 4 минуты нужно хранить в кэше еще 4 минуты работы в сессии.





